<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
	<title>qube - автоматизация в облаке</title>

	<link href="/assets/css/icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/materialize.min.css" type="text/css" media="screen,projection" />
    <link rel="stylesheet" href="/assets/css/custom.css" type="text/css" media="screen,projection" />
    <script src="/assets/js/jquery-3.3.1.min.js"></script>
	<script src="/assets/js/materialize.min.js"></script>
    <script type="text/javascript" src="/assets/js/custom.js"></script>
</head>
<body class="white grey-text text-darken-4">

<nav class="light-blue darken-2" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="/" class="brand-logo">qube</a>

        <ul class="right hide-on-med-and-down">
            <li><a href="#" data-activates="slide-out" id="settings-menu"><i class="material-icons left">settings</i> Персонализация</a></li>
            <li><a href="/favorites/" id="bpo-menu"><i class="material-icons left">pin_drop</i> Мои документы 

                {% if pinnedBPOCount|integer > 0 %}
                    <span class="new badge orange" data-badge-caption="">{{ pinnedBPOCount|integer }}</span>
                {% endif %}
                
            </a></li>
        </ul>

        <ul id="nav-mobile" class="side-nav">
            <li><a href="#" data-activates="slide-out" id="settings-menu"><i class="material-icons left">settings</i> Персонализация</a></li>
            <li><a href="/my-blueprints/" id="bpo-menu"><i class="material-icons left">pin_drop</i> Мои документы 

                {% if pinnedBPOCount|integer > 0 %}
                <span id="pinned-count" class="new badge orange" data-badge-caption="">{{ pinnedBPOCount|integer }}</span>
                {% endif %}
                </a></li>
        </ul>
        <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>

</nav>
<nav class="light-blue darken-4" role="navigation">
    <ul class="left hide-on-med-and-down">
        <li><a href="/dashboard/">Рабочий стол</a></li>
        <li><a href="/tasks/">Задачи</a></li>
        <li><a href="/registry/">Документы</a></li>
        <li><a href="/projects/">Проекты</a></li>
        <li><a href="/calendar/">Встречи</a></li>
        <li><a class='dropdown-trigger' href='#' data-target='dropdown1'>Система</a></li>
    </ul>
    <ul id='dropdown1' class='dropdown-content'>
        <li><a href="/system/organization/">Организация</a></li>
        <li><a href="/system/users/">Пользователи</a></li>
        <li><a href="/system/roles/">Роли</a></li>
        <li class="divider" tabindex="-1"></li>
        <li><a href="/system/docs/">Документы</a></li>
        <li><a href="/system/forms/">Формы</a></li>
        <li><a href="/system/references/">Справочники</a></li>
        <li class="divider" tabindex="-1"></li>
        <li><a href="/system/projects/">Проекты</a></li>
        <li><a href="/system/registry/">Реестры</a></li>
        <li><a href="/system/tasks/">Задачи</a></li>
    </ul>
</nav>


        

        

{% macro RenderSubMatRows(component, componentLpath, materials) %}

    {% for m in materials %}

        {% if m.BpoID == component and m.LPath.In(componentLpath) %}

            <tr{% if m.ComponentBPO != 0 and m.LPath.In(componentLpath) %} class="no-border"{% endif %}>
                <td style="padding-left: {{ 10 * m.Lvl }}px;" class="valign-wrapper">
                    {% if m.ComponentBPO != 0 %}
                        <a class="valign-wrapper" href="/item/{{ m.ComponentBPO|EncryptURL }}">
                            <img src="/images/types/{{ m.MaterialID }}_32.png" class="eve-icon"> {{ m.MaterialName }}
                        </a>
                    {% else %}
                        <img src="/images/types/{{ m.MaterialID }}_32.png" class="eve-icon"> {{ m.MaterialName }}
                    {% endif %}
                </td>
                <td>{{ m.Quantity|FormatPrice }}</td>
                <td>{{ m.AvgPrice|FormatPrice }}</td>
                <td>{{ m.Cost|FormatPrice }}</td>
                <td>{{ m.TotalVolume|FormatPrice }}</td>
                <td>{% if m.ComponentBPO != 0 %}{{ m.ActivityName }}{% endif %}</td>
            </tr>

            {% if m.ComponentBPO != 0 and m.LPath.In(componentLpath) %}

                {{ RenderSubMatRows(m.ComponentBPO, m.LPath, materials) }}

            {% endif %}

        {% endif %}

    {% endfor %}

{% endmacro %}



<div class="container">
		<div class="row">
			<div class="col s12 l12">
                

                {% if selected == "index" %}
                    <nav class="blue-grey lighten-2">
                {% elif selected == "manufacturing" %}
                    <nav class="orange lighten-1">
                {% elif selected == "research" %}
                    <nav class="blue lighten-1">
                {% elif selected == "market" %}
                    <nav class="grey lighten-1">
                {% elif selected == "timeline" %}
                    <nav class="green lighten-1">
                {% endif %}
                    <div class="nav-wrapper">
                        <ul id="nav-mobile" class="left hide-on-med-and-down">
                            <li{% if selected == "index" %} class="active"{% endif %}><a href="/item/{{ item.TypeID|EncryptURL }}">General</a></li>
                            <li{% if selected == "manufacturing" %} class="active"{% endif %}><a href="/item-manufacturing/{{ item.TypeID|EncryptURL }}">Manufacturing</a></li>
                            <li{% if selected == "research" %} class="active"{% endif %}><a href="/item-research/{{ item.TypeID|EncryptURL }}">Invention</a></li>
                            <li{% if selected == "market" %} class="active"{% endif %}><a href="/market/{{ item.TypeID|EncryptURL }}">Market</a></li>
                            <li{% if selected == "timeline" %} class="active"{% endif %}><a href="/timeline/{{ item.TypeID|EncryptURL }}">Production timeline</a></li>
                            <li><a href="#" class="my-blueprints-control" data-typeid="{{ item.TypeID|EncryptURL }}"><i class="material-icons" title="Pin it!">pin_drop</i></a></li>
                        </ul>
                    </div>
                </nav>

                <h3 class="valign-wrapper">
                       <img src="/images/types/{{ item.TypeID }}_64.png"> {{ item.BpoName }}
                </h3>


                
                

<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/drag-panes.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<script src="https://code.highcharts.com/stock/indicators/indicators.js"></script>
<script src="https://code.highcharts.com/stock/indicators/volume-by-price.js"></script>

<script src="https://code.highcharts.com/stock/highcharts-more.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>

	<div class="row">
        
        <h5>Market history for {{ Region }}</h5>
        
            <div id="container" style="height: 500px; min-width: 310px"></div>

        </div>

        <script>
            $.getJSON('/market-history/{{ itemData.TypeID|EncryptURL }}/', function (data_i) {

                if (data_i.Error != null) {
                    $("#container").html("Error: "+data_i.Error);
                    return
                }

                data = data_i.Result;

                // split the data set into ohlc and volume
                var ohlc = [],
                        volume = [],
                        avg = [],
                        dataLength = data.length,
                        // set the allowed units for data grouping
                        groupingUnits = [[
                            'week',                         // unit name
                            [1]                             // allowed multiples
                        ], [
                            'month',
                            [1, 2, 3, 4, 6]
                        ]],

                        i = 0;

                for (i; i < dataLength; i += 1) {
                    ohlc.push([
                        data[i][0], // the date
                        data[i][2], // high
                        data[i][3] // low
                    ]);

                    volume.push([
                        data[i][0], // the date
                        data[i][4] // the volume
                    ]);

                    avg.push([
                        data[i][0], // the date
                        data[i][1] // avg
                    ]);
                }


                // create the chart
                Highcharts.stockChart('container', {

                    rangeSelector: {
                        selected: 1
                    },

                    title: {
                        text: '{{ itemData.TypeName }}'
                    },

                    yAxis: [{
                        labels: {
                            align: 'right',
                            x: -3
                        },
                        title: {
                            text: 'Orders'
                        },
                        height: '60%',
                        lineWidth: 2,
                        resize: {
                            enabled: true
                        }
                    }, {
                        labels: {
                            align: 'right',
                            x: -3
                        },
                        title: {
                            text: 'Volume'
                        },
                        top: '65%',
                        height: '35%',
                        offset: 0,
                        lineWidth: 2
                    }],

                    tooltip: {
                        split: true
                    },

                    series: [{
                        type: 'columnrange',
                        name: 'Price range',
                        data: ohlc,
                        dataGrouping: {
                            units: groupingUnits
                        },
                        fillOpacity: 0.7,
                        zIndex: 0
                    },
                        {
                            zIndex: 1,
                            name: 'Average',
                            data: avg,
                            linkedTo: ':previous',
                            color: Highcharts.getOptions().colors[3],
                            dataGrouping: {
                                units: groupingUnits
                            }
                        },
                        {
                        type: 'column',
                        name: 'Volume',
                        data: volume,
                        yAxis: 1,
                        dataGrouping: {
                            units: groupingUnits
                        }
                    }]
                });
            });
        </script>



			</div>
		</div>
</div>


<footer class="page-footer light-blue darken-4">
    <div class="container">
        <div class="row">
            <div class="col l4 s12">
                <h5>
                    Новости и релизы
                </h5>
                <p>Последние новости и релизы</p>
            </div>
            <div class="col l4 s12">
                <h5>
                    Свяжитесь с нами
                </h5>
                </div>
            <div class="col l4 s12">
                <h5>
                    Куки файлы
                </h5>
                <p>Этот сайт использует файлы куки для технических целей.</p>
            </div>
        </div>
    </div>
    <div class="footer-copyright">
        <div class="row">
            &copy;&nbsp;2018 qube, All rights reserved.
        </div>
    </div>
</footer>



<ul id="slide-out" class="side-nav grey lighten-3">
    <li><div class="user-view">
    {% if currentUser.UserID == 0 %}
        <span class="blue-text"><i class="material-icons medium">person</i></span>
        <span class="blue-text name"><a href="/login/"><img src="/assets/images/EVE_SSO_Login_Buttons_Small_White.png"></a></span>
    {% else %}
        <div class="background">
            <img src="https://imageserver.eveonline.com/Character/{{ currentUser.UserID }}_512.jpg" width="300">
        </div>
        <div style="height: 270px;"></div>
        <h5 class="blue-text">{{ currentUser.UserLastName }}</h5>
        <span class="blue-text name"><a href="/login/"><img src="/assets/images/EVE_SSO_Login_Buttons_Small_White.png"></a></span>
    {% endif %}
    </div></li>
    <li><div class="divider"></div></li>
    <li>
        <div class="row">
            <div class="col l1 s12"></div>
            <div class="col l10 s12">

            </div>
            <div class="col l1 s12"></div>
        </div>
    </li>
</ul>




</body>
</html>